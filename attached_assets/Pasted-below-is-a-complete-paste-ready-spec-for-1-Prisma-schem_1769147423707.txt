below is a complete, paste-ready spec for (1) Prisma schema + (2) Revenue dashboard + (3) Razorpay mapping + (4) i18n copy (EN + HI + MS + TA), aligned to your тАЬPlans primary, add-ons multiplierтАЭ strategy.

1) Prisma Schema (Marketplace + Country Rollout + Pricing Tiers)
тЬЕ Create/Update these files

prisma/schema.prisma (add models)

server/core/marketplace/addon-catalog.ts (constants)

server/core/marketplace/pricing.ts (tier resolve)

server/routes/marketplace.ts (tenant marketplace APIs)

server/routes/super-admin-marketplace.ts (super admin controls)

тЬЕ Prisma Models (paste into prisma/schema.prisma)
enum AddonBillingModel {
  FLAT_MONTHLY
  PER_EMPLOYEE
  PER_UNIT
}

enum AddonStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum TenantAddonStatus {
  TRIALING
  ACTIVE
  PAST_DUE
  CANCELED
  EXPIRED
}

model Addon {
  id            String      @id @default(cuid())
  code          String      @unique // "payroll", "hrms"
  name          String
  description   String?
  category      String      // "hr", "automation", etc.
  billingModel  AddonBillingModel
  status        AddonStatus @default(DRAFT)

  // UI metadata
  iconKey       String?     // "payroll", "hrms"
  screenshotKey String?     // "payroll_01"

  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  countryConfigs AddonCountryConfig[]
  planEligibility AddonPlanEligibility[]
  pricingTiers    AddonPricingTier[]
}

model AddonCountryConfig {
  id          String   @id @default(cuid())
  addonId     String
  countryCode String   // "IN", "MY", "GB"
  isActive    Boolean  @default(false) // rollout toggle
  currencyCode String  // "INR", "MYR"
  trialDays   Int      @default(0)     // e.g., Payroll 7 days
  complianceNote String?

  addon       Addon    @relation(fields: [addonId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([addonId, countryCode])
  @@index([countryCode, isActive])
}

model AddonPlanEligibility {
  id        String @id @default(cuid())
  addonId   String
  planTier  String // "free" | "basic" | "pro"
  canPurchase Boolean @default(true)
  canTrial    Boolean @default(false)

  addon     Addon  @relation(fields: [addonId], references: [id])

  @@unique([addonId, planTier])
}

model AddonPricingTier {
  id           String @id @default(cuid())
  addonId      String
  countryCode  String
  currencyCode String

  // pricing rule: employeeCount between min..max => pricePerUnit + minimum
  minUnits     Int
  maxUnits     Int?    // null = no upper limit
  pricePerUnit Int     // store smallest unit (paise/sen) if you use decimals
  minimumPrice Int     // minimum monthly charge in smallest unit

  // optional yearly pricing
  yearlyDiscountPct Int? // e.g. 15

  addon        Addon  @relation(fields: [addonId], references: [id])

  @@index([addonId, countryCode])
}

model TenantAddonSubscription {
  id            String @id @default(cuid())
  tenantId      String
  addonCode     String     // "payroll"
  countryCode   String
  currencyCode  String

  status        TenantAddonStatus @default(TRIALING)
  trialEndsAt   DateTime?
  currentPeriodStart DateTime?
  currentPeriodEnd   DateTime?

  // billing inputs
  units         Int      @default(0) // employees
  monthlyAmount Int      @default(0) // computed final amount

  // Razorpay mapping
  provider      String   @default("razorpay")
  providerPlanId        String?
  providerSubscriptionId String?
  providerCustomerId    String?

  canceledAt    DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([tenantId, addonCode])
  @@unique([tenantId, addonCode]) // one active record per addon per tenant
}

model MarketplaceEvent {
  id        String   @id @default(cuid())
  source    String   // "razorpay"
  eventType String   // "subscription.activated"
  eventId   String   @unique
  payload   Json
  processed Boolean  @default(false)
  createdAt DateTime @default(now())
}

model MarketplaceAuditLog {
  id         String   @id @default(cuid())
  actorUserId String
  action     String   // "ADDON_PUBLISH", "ADDON_ROLLOUT_TOGGLE", "PRICING_UPDATE"
  targetType String   // "addon", "addonCountryConfig", "pricingTier"
  targetId   String
  meta       Json?
  createdAt  DateTime @default(now())

  @@index([action, createdAt])
}

тЬЕ Seed: Add HRMS + Payroll into marketplace

Create: server/db/seeds/seed-addons.ts

Insert Addon records for hrms, payroll

Insert AddonCountryConfig for IN, MY (isActive true/false)

Insert AddonPlanEligibility (Free cannot purchase; Basic trial; Pro purchase)

Insert AddonPricingTier using your IN/MY tier tables

2) Marketplace Revenue Dashboard (Super Admin Analytics)
тЬЕ What to show (KPIs + tables + conversion funnel)
Top KPIs (cards)

Active Add-on Subscriptions

MTD Add-on Revenue

YTD Add-on Revenue

Avg Add-ons / Tenant

Trial тЖТ Paid Conversion %

Payroll Attach Rate (% Pro tenants with Payroll)

Tables

Revenue by Add-on

Add-on | Category | Active Tenants | MTD Revenue | YTD Revenue | TrialтЖТPaid %

Revenue by Country

Country | Tenants | Active Add-ons | MTD Revenue | Top Add-on

Conversion Funnel

Viewed Marketplace тЖТ Started Trial тЖТ Activated Paid тЖТ Retained 30 days

тЬЕ API Endpoints

Create: server/routes/super-admin-marketplace-analytics.ts

GET /api/super-admin/marketplace/analytics/overview?from=YYYY-MM-DD&to=YYYY-MM-DD

GET /api/super-admin/marketplace/analytics/by-addon

GET /api/super-admin/marketplace/analytics/by-country

GET /api/super-admin/marketplace/analytics/funnel

тЬЕ How to compute revenue (simple + accurate)

Use TenantAddonSubscription.monthlyAmount + active periods.
If you store invoices later, replace this with invoice aggregation.

Pseudo SQL idea (inside storage layer):

MTD: subscriptions where status=ACTIVE and period overlaps current month.

YTD: same but year range.

Trials: status=TRIALING, trialEndsAt not null.

3) Razorpay Add-on Subscription Mapping (per-employee tiers + trial + bundle discounts)
тЬЕ Recommended approach (clean & scalable)

One Razorpay Plan per country + addon + billing cycle + pricing tier

Create Razorpay Subscription with:

plan_id = providerPlanId

quantity = employees (units)

trial_end if trial is enabled

Bundle discount:

Option A (simplest): create a тАЬbundleтАЭ plan_id (discounted) for Pro+Payroll

Option B: apply coupon/offer if you already use Razorpay offers (optional)

тЬЕ Internal тЖТ Razorpay Mapping Table
Internal concept	Stored in DB	Razorpay object
Add-on enablement	AddonCountryConfig.isActive	N/A
Pricing tier	AddonPricingTier	Razorpay plan amount
Subscription	TenantAddonSubscription	subscription_id
Units (employees)	TenantAddonSubscription.units	subscription.quantity
Trial	trialEndsAt	trial_end
Status	TenantAddonStatus	subscription status events
тЬЕ Webhooks you must support

Create: server/routes/webhooks/razorpay.ts

Handle these (minimum):

subscription.activated

subscription.charged

subscription.completed

subscription.halted

subscription.cancelled

payment.failed

тЬЕ Webhook processing rules

Verify signature: x-razorpay-signature

Insert into MarketplaceEvent (idempotent by eventId)

Worker processes events тЖТ updates TenantAddonSubscription

Status mapping example:

activated тЖТ ACTIVE

charged тЖТ ACTIVE + update period dates

halted/payment.failed тЖТ PAST_DUE

cancelled тЖТ CANCELED

completed тЖТ EXPIRED

тЬЕ тАЬStart TrialтАЭ flow

POST /api/marketplace/addons/payroll/trial

validate:

country rollout active

plan eligibility allows trial

not already trialed (optional)

create TenantAddonSubscription with:

status=TRIALING

trialEndsAt = now + 7 days

no Razorpay subscription yet OR create with trial_end (your call)

Best practice: create subscription immediately with trial_end so conversion is automatic.

4) i18n Keys (EN + HI + MS + TA) тАФ Marketplace + Add-ons + Micro-benefits
тЬЕ Add these keys in:

client/src/i18n/locales/en.json

client/src/i18n/locales/hi.json

client/src/i18n/locales/ms.json

client/src/i18n/locales/ta.json

тЬЕ Core Marketplace Labels
{
  "marketplaceTitle": "Add-on Marketplace",
  "marketplaceSubtitle": "Add extra modules when you need them. Keep your base plan simple.",
  "browseAddons": "Browse Add-ons",
  "installedAddons": "Installed",
  "noAddonsInstalledTitle": "No add-ons installed",
  "noAddonsInstalledDesc": "Browse the marketplace to find add-ons for your business.",
  "addonLive": "Live",
  "addonSoon": "Soon",
  "addonStartTrial": "Start trial",
  "addonBuyNow": "Buy now",
  "addonManage": "Manage",
  "addonCancel": "Cancel",
  "addonRequiresUpgradeTitle": "Available on Pro plan",
  "addonRequiresUpgradeDesc": "Upgrade your plan to unlock this add-on.",
  "upgradePlan": "Upgrade plan"
}

тЬЕ Add-on Names
{
  "addon.payroll.name": "Payroll",
  "addon.payroll.desc": "Run salaries, payslips, statutory deductions and bank files.",

  "addon.hrms.name": "HRMS",
  "addon.hrms.desc": "Employees, attendance, timesheets and leave management.",

  "addon.whatsapp.name": "WhatsApp Automation",
  "addon.whatsapp.desc": "Send reminders and updates automatically on WhatsApp."
}

тЬЕ Micro-benefits (country-specific)
{
  "addon.payroll.micro.IN.1": "Generate payslips in seconds",
  "addon.payroll.micro.IN.2": "PF/ESI/PT ready reports",
  "addon.payroll.micro.IN.3": "Bank transfer file export",

  "addon.payroll.micro.MY.1": "EPF/SOCSO/EIS compliant",
  "addon.payroll.micro.MY.2": "PCB calculations supported",
  "addon.payroll.micro.MY.3": "EA form export ready"
}

тЬЕ Usage-based micro-benefits (dynamic)
{
  "addon.payroll.usage.high": "You're managing a growing team тАФ payroll saves hours every month.",
  "addon.hrms.usage.high": "Attendance + timesheets keep your team accountable as you scale."
}

тЬЕ Translations (HI + MS + TA) for the most visible keys
HI (Hindi)
{
  "marketplaceTitle": "рдРрдб-рдСрди рдорд╛рд░реНрдХреЗрдЯрдкреНрд▓реЗрд╕",
  "marketplaceSubtitle": "рдЬрд╝рд░реВрд░рдд рдХреЗ рд╣рд┐рд╕рд╛рдм рд╕реЗ рдореЙрдбреНрдпреВрд▓ рдЬреЛрдбрд╝реЗрдВред рдмреЗрд╕ рдкреНрд▓рд╛рди рд╕рд░рд▓ рд░рдЦреЗрдВред",
  "browseAddons": "рдРрдб-рдСрди рджреЗрдЦреЗрдВ",
  "installedAddons": "рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд┐рдП рдЧрдП",
  "noAddonsInstalledTitle": "рдХреЛрдИ рдРрдб-рдСрди рдЗрдВрд╕реНрдЯреЙрд▓ рдирд╣реАрдВ рд╣реИ",
  "noAddonsInstalledDesc": "рдЕрдкрдиреЗ рдмрд┐рдЬрд╝рдиреЗрд╕ рдХреЗ рд▓рд┐рдП рдРрдб-рдСрди рдЪреБрдирдиреЗ рд╣реЗрддреБ рдорд╛рд░реНрдХреЗрдЯрдкреНрд▓реЗрд╕ рджреЗрдЦреЗрдВред",
  "addonLive": "рд▓рд╛рдЗрд╡",
  "addonSoon": "рдЬрд▓реНрдж",
  "addonStartTrial": "рдЯреНрд░рд╛рдпрд▓ рд╢реБрд░реВ рдХрд░реЗрдВ",
  "addonBuyNow": "рдЕрднреА рдЦрд░реАрджреЗрдВ",
  "addonManage": "рдореИрдиреЗрдЬ рдХрд░реЗрдВ",
  "addonCancel": "рдХреИрдВрд╕рд▓ рдХрд░реЗрдВ",
  "addonRequiresUpgradeTitle": "Pro рдкреНрд▓рд╛рди рдореЗрдВ рдЙрдкрд▓рдмреНрдз",
  "addonRequiresUpgradeDesc": "рдЗрд╕ рдРрдб-рдСрди рдХреЛ рдЕрдирд▓реЙрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд▓рд╛рди рдЕрдкрдЧреНрд░реЗрдб рдХрд░реЗрдВред",
  "upgradePlan": "рдкреНрд▓рд╛рди рдЕрдкрдЧреНрд░реЗрдб рдХрд░реЗрдВ",

  "addon.payroll.name": "рдкреЗрд░реЛрд▓",
  "addon.payroll.desc": "рд╕реИрд▓рд░реА, рдкреЗрд╕реНрд▓рд┐рдк, рдХрдЯреМрддреА рдФрд░ рдмреИрдВрдХ рдлрд╛рдЗрд▓ рддреИрдпрд╛рд░ рдХрд░реЗрдВред",
  "addon.hrms.name": "HRMS",
  "addon.hrms.desc": "рдХрд░реНрдордЪрд╛рд░реА, рдЙрдкрд╕реНрдерд┐рддрд┐, рдЯрд╛рдЗрдорд╢реАрдЯ рдФрд░ рд▓реАрд╡ рдореИрдиреЗрдЬрдореЗрдВрдЯред"
}

MS (Malay)
{
  "marketplaceTitle": "Marketplace Add-on",
  "marketplaceSubtitle": "Tambah modul bila diperlukan. Kekalkan pelan asas ringkas.",
  "browseAddons": "Semak Add-on",
  "installedAddons": "Dipasan╔б",
  "noAddonsInstalledTitle": "Tiada add-on dipasang",
  "noAddonsInstalledDesc": "Semak marketplace untuk cari add-on untuk perniagaan anda.",
  "addonLive": "Live",
  "addonSoon": "Soon",
  "addonStartTrial": "Mulakan percubaan",
  "addonBuyNow": "Beli sekarang",
  "addonManage": "Urus",
  "addonCancel": "Batal",
  "addonRequiresUpgradeTitle": "Tersedia pada pelan Pro",
  "addonRequiresUpgradeDesc": "Naik taraf pelan untuk buka add-on ini.",
  "upgradePlan": "Naik taraf pelan",

  "addon.payroll.name": "Payroll",
  "addon.payroll.desc": "Urus gaji, slip gaji, potongan statutori dan fail bank.",
  "addon.hrms.name": "HRMS",
  "addon.hrms.desc": "Pekerja, kehadiran, timesheet dan cuti."
}

TA (Tamil)
{
  "marketplaceTitle": "роЖроЯрпН-роЖройрпН рооро╛ро░рпНроХрпНроХрпЖроЯрпНрокро┐ро│рпЗро╕рпН",
  "marketplaceSubtitle": "родрпЗро╡рпИрокрпНрокроЯрпБроорпН рокрпЛродрпБ роХрпВроЯрпБродро▓рпН рооро╛роЯрпНропрпВро▓рпНроХро│рпИ роЪрпЗро░рпНроХрпНроХро╡рпБроорпН. роЕроЯро┐рокрпНрокроЯрпИ родро┐роЯрпНроЯродрпНродрпИ роОро│ро┐роорпИропро╛роХ ро╡рпИродрпНродро┐ро░рпБроХрпНроХро╡рпБроорпН.",
  "browseAddons": "роЖроЯрпН-роЖройрпНроХро│рпИ рокро╛ро░рпНро╡рпИропро┐роЯрпБроЩрпНроХро│рпН",
  "installedAddons": "роиро┐ро▒рпБро╡рокрпНрокроЯрпНроЯро╡рпИ",
  "noAddonsInstalledTitle": "роЖроЯрпН-роЖройрпНроХро│рпН роОродрпБро╡рпБроорпН роиро┐ро▒рпБро╡рокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ",
  "noAddonsInstalledDesc": "роЙроЩрпНроХро│рпН ро╡рогро┐роХродрпНродро┐ро▒рпНроХрпБ роПро▒рпНро▒ роЖроЯрпН-роЖройрпНроХро│рпИ рооро╛ро░рпНроХрпНроХрпЖроЯрпНрокро┐ро│рпЗро╕ро┐ро▓рпН роЗро░рпБроирпНродрпБ родрпЗро░рпНро╡рпБ роЪрпЖропрпНропрпБроЩрпНроХро│рпН.",
  "addonLive": "ро▓рпИро╡рпН",
  "addonSoon": "ро╡ро┐ро░рпИро╡ро┐ро▓рпН",
  "addonStartTrial": "роЯрпНро░ропро▓рпН родрпКроЯроЩрпНроХрпБ",
  "addonBuyNow": "роЗрокрпНрокрпЛродрпБ ро╡ро╛роЩрпНроХрпБ",
  "addonManage": "роорпЗро▓ро╛рогрпНроорпИ",
  "addonCancel": "ро░родрпНродрпБ",
  "addonRequiresUpgradeTitle": "Pro родро┐роЯрпНроЯродрпНродро┐ро▓рпН роХро┐роЯрпИроХрпНроХрпБроорпН",
  "addonRequiresUpgradeDesc": "роЗроирпНрод роЖроЯрпН-роЖройрпИ родро┐ро▒роХрпНроХ родро┐роЯрпНроЯродрпНродрпИ роорпЗроорпНрокроЯрпБродрпНродрпБроЩрпНроХро│рпН.",
  "upgradePlan": "родро┐роЯрпНроЯродрпНродрпИ роорпЗроорпНрокроЯрпБродрпНродрпБ",

  "addon.payroll.name": "рокрпЗро░рпЛро▓рпН",
  "addon.payroll.desc": "роЪроорпНрокро│роорпН, рокрпЗро╕рпНро▓ро┐рокрпН, роХро┤ро┐рокрпНрокрпБроХро│рпН рооро▒рпНро▒рпБроорпН ро╡роЩрпНроХро┐ роХрпЛрокрпНрокрпБроХро│рпИ роиро┐ро░рпНро╡роХро┐роХрпНроХро╡рпБроорпН.",
  "addon.hrms.name": "HRMS",
  "addon.hrms.desc": "роКро┤ро┐ропро░рпНроХро│рпН, ро╡ро░рпБроХрпИ, роЯрпИроорпНро╖рпАроЯрпН рооро▒рпНро▒рпБроорпН ро╡ро┐роЯрпБрокрпНрокрпБ роорпЗро▓ро╛рогрпНроорпИ."
}

ЁЯФР Marketplace Controls тАФ who can add/publish/activate?
Super Admin must have:

Manage catalog (create/edit add-ons)

Publish add-ons

Toggle per-country rollout (IN/MY/UK)

Update pricing tiers

View analytics

That means your Super Admin UI needs 2 pages:

Marketplace Catalog (Add-ons list + create/edit + publish)

Rollout Matrix (country x addon toggles + pricing)

Right now you have analytics only тАФ you need these two control screens.