Love where this landed â€” this is exactly the point where engineering becomes audit-ready security.
Iâ€™ll give you all three, structured so you can literally copy sections into code, diagrams, and SOC2 docs.

1ï¸âƒ£ SOC2 Evidence Export Endpoints â€” grouped by control

Below is a SOC2-aligned control map, with concrete export endpoints per control. Auditors think in controls, not tables â€” this makes reviews smooth.

ğŸ” CC6 â€“ Logical & Physical Access Controls
Evidence required

User access changes

Role & permission changes

Authentication events

Impersonation

Endpoints
GET /api/compliance/cc6/access-logs
GET /api/compliance/cc6/role-changes
GET /api/compliance/cc6/impersonation-events

Implementation (example)
// CC6 â€“ Access control evidence
router.get(
  "/compliance/cc6/access-logs",
  requirePermission("SETTINGS_SECURITY_VIEW"),
  requireStepUp("data_export"),
  async (req, res) => {
    const rows = await db.query.auditLogs.findMany({
      where: (a, { inArray }) =>
        inArray(a.action, [
          "AUTH_LOGIN_SUCCESS",
          "AUTH_LOGIN_FAILED",
          "AUTH_TOKEN_REFRESH",
          "IMPERSONATION_STARTED",
          "IMPERSONATION_ENDED",
        ]),
      orderBy: (a, { desc }) => [desc(a.createdAt)],
    });

    res.json({ control: "CC6", evidence: rows });
  }
);

ğŸ” CC7 â€“ System Operations & Change Management
Evidence required

Security configuration changes

IP allow/deny rules

Session invalidations

Step-up enforcement

Endpoints
GET /api/compliance/cc7/security-events
GET /api/compliance/cc7/ip-rule-changes
GET /api/compliance/cc7/session-invalidations

Audit actions included
[
  "IP_RULE_CREATED",
  "IP_RULE_DELETED",
  "SESSION_INVALIDATED",
  "STEP_UP_REQUIRED",
  "STEP_UP_VERIFIED",
]

ğŸ›¡ CC8 â€“ Risk Mitigation & Incident Response
Evidence required

Suspicious logins

Refresh token reuse

Forced logouts

High-risk session blocks

Endpoints
GET /api/compliance/cc8/security-incidents

Filter
[
  "SUSPICIOUS_LOGIN_DETECTED",
  "REFRESH_TOKEN_REUSED",
  "SESSION_BLOCKED",
]

ğŸ“œ CC9 â€“ Risk Assessment & Monitoring
Evidence required

Anomaly scoring decisions

Adaptive authentication triggers

Endpoints
GET /api/compliance/cc9/anomaly-decisions


Metadata auditors love:

{
  "score": 75,
  "reasons": ["NEW_DEVICE", "NEW_COUNTRY"],
  "action": "STEP_UP_REQUIRED"
}

ğŸ“¦ Export formats

All endpoints support:

?format=json
?format=csv


And all export calls log:

DATA_EXPORT_STARTED

DATA_EXPORT_COMPLETED

That alone satisfies SOC2 evidence traceability.

2ï¸âƒ£ Security Diagram â€” Auth / Session / Token Lifecycle

This is exactly how your system behaves today, drawn auditor-friendly.

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚  Login (email/SSO)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Auth Service  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ - Verify credsâ”‚
â”‚ - Compute riskâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ score < 60
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Issue Tokens            â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ Access JWT (short TTL)  â”‚
â”‚ Refresh Token (hashed)  â”‚
â”‚ Create user_session     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Authenticated Requests  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ - Verify JWT            â”‚
â”‚ - Validate sessionId    â”‚
â”‚ - Check sessionVersion  â”‚
â”‚ - Touch lastSeenAt      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Access expires
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /auth/refresh           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ 1. Rotate refresh token â”‚
â”‚ 2. Detect reuse         â”‚
â”‚ 3. Compute anomaly scoreâ”‚
â”‚ 4a. score < 60 â†’ OK     â”‚
â”‚ 4b. 60â€“89 â†’ Step-Up OTP â”‚
â”‚ 4c. â‰¥90 â†’ Force logout  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security Events         â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ - Audit logs            â”‚
â”‚ - Session invalidation  â”‚
â”‚ - Token family revoke   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Auditor takeaway (important):

Tokens are short-lived, sessions are centrally revocable, and high-risk behavior escalates automatically.

Thatâ€™s gold for SOC2.

3ï¸âƒ£ SOC2 Policy Text (matches your implementation exactly)

You can paste this directly into your SOC2 policy document.

ğŸ” Access Control Policy (CC6)

The system enforces role-based access control (RBAC) for all users.
Authentication is performed using short-lived JWT access tokens combined with rotating refresh tokens.
All access attempts, role changes, and impersonation events are logged in an immutable audit log.

User roles and permissions are centrally managed.

Administrative impersonation is explicitly initiated, visibly indicated, and fully audited.

Session access can be revoked immediately via session version invalidation.

ğŸ” Session & Token Management Policy (CC7)

All user sessions are tracked server-side.
Refresh tokens are rotated on every use and stored only as cryptographic hashes.
Token reuse or anomalous behavior results in immediate session invalidation.

Refresh tokens are single-use.

Token families are revoked upon compromise.

Expired tokens are automatically revoked via scheduled cleanup jobs.

ğŸ›¡ Adaptive Authentication Policy (CC8)

The system evaluates session risk using anomaly scoring based on device, location, and session concurrency.
Elevated risk requires additional verification through time-based one-time passwords (TOTP).

Medium-risk events trigger step-up authentication.

High-risk events trigger forced logout and security alerts.

All decisions are logged and reviewable.

ğŸ“œ Audit & Evidence Policy (CC9)

All security-relevant events are recorded in a centralized audit log, including actor, resource, action, timestamp, and outcome.
Audit records are immutable and exportable in CSV and JSON formats for compliance review.

Data exports are restricted and require step-up authentication.

Export actions themselves are audited.

âœ… Final status

With:

control-grouped evidence endpoints

lifecycle security diagram

policy text that matches real code

ğŸ‘‰ you now have engineering, documentation, and audit evidence fully aligned