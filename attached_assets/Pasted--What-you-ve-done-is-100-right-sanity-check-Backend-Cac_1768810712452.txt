âœ… What youâ€™ve done is 100% right (sanity check)
Backend

âœ” Cache-Control: no-store, no-cache, must-revalidate, proxy-revalidate
âœ” Added updatedAt + version â†’ good for cache busting & visual verification
âœ” Public route (/api/public/rollouts) with no auth dependency
âœ” Dev-only logs â†’ safe

This fully eliminates:

CDN caching

Browser caching

Server-side stale responses

Frontend

âœ” Explicit fetch() â†’ bypasses global API client & auth interceptors
âœ” staleTime: 0, gcTime: 0 â†’ no React Query cache reuse
âœ” refetchOnMount: "always" + refetchOnWindowFocus: true
âœ” Manual refetch() on modal open
âœ” Badge logic driven only by isActive === true
âœ” Error boundary + Retry
âœ” Dev-only logging

This is exactly how rollout gating should be done on a public landing page.

ğŸ” Final Production Verification Checklist (do this in order)
1ï¸âƒ£ Network tab (most important)

Open DevTools â†’ Network â†’ Fetch/XHR

Click Get Started â†’ Country Selector

Click the /api/public/rollouts request

Confirm ALL of these:

Response Headers

Cache-Control: no-store, no-cache, must-revalidate, proxy-revalidate


Response Body

{
  "version": "...",
  "updatedAt": "...",
  "countries": [
    { "countryCode": "IN", "isActive": true },
    { "countryCode": "MY", "isActive": true }
  ]
}


If this matches â†’ backend is perfect.

2ï¸âƒ£ UI mapping check

In the modal:

Country	Expected
ğŸ‡®ğŸ‡³ India	ğŸŸ¢ Live
ğŸ‡²ğŸ‡¾ Malaysia	ğŸŸ¢ Live
ğŸ‡¬ğŸ‡§ UK	Soon
ğŸ‡¦ğŸ‡ª UAE	Soon
ğŸ‡¸ğŸ‡¬ SG	Soon

If IN/MY are green, rollout is working.

3ï¸âƒ£ Selection persistence

Click Malaysia

Then in Console:

localStorage.getItem("app:country")


âœ… Must return:

"MY"


Reload page â†’ pricing & signup must remain MY-specific.

â— If it is STILL wrong (only 2 real possibilities left)
Case A â€” CDN / hosting layer caching (VERY likely)

If youâ€™re using:

Cloudflare

Vercel Edge

Nginx reverse proxy

Then headers alone are not enough.

Fix (one-time):

Force dynamic response at hosting layer.

If Vercel

export const dynamic = "force-dynamic";


If Express behind CDN
Add:

res.setHeader("Surrogate-Control", "no-store");


Cloudflare

Page Rule:
payodsoft.co.uk/api/public/* â†’ Cache Level: Bypass

Case B â€” Old production bundle

If the Network response is correct but UI still wrong:

Your production site is serving an older JS build

Do a full redeploy

Then hard refresh:

Mac: Cmd + Shift + R

Windows: Ctrl + Shift + R

ğŸ§  One last important note (this is good news)

This error in your Network tab is NOT related:

/user â†’ 401


That is expected on landing pages and must be ignored.
Your rollout logic is correctly isolated â€” well done.

âœ… Verdict

Youâ€™ve implemented this the right way, not a workaround.

Once the hosting cache (if any) is bypassed, this system will:

Scale cleanly to 50+ countries

Allow instant rollout toggles

Never require frontend redeploys again for country launches

If you want, next I can help you:

Add â€œPhase 1 / Phase 2â€ labels

Add rollout % / beta badge

Add geo-auto-select country

Add A/B rollout per business type

Just tell me ğŸ‘